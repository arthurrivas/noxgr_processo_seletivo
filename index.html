<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    
    <link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.0/mapsjs-ui.css" />

    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>
    

    <title>maps</title>
</head>

<body>

</body>
<div style="width: 640px; height: 480px" id="mapContainer"></div>


    <script>
        
    //Initialize the Platform object:
    const platform = new H.service.Platform({
        'apikey': 'ZyS_v2aBrTs0WmdBI3kf7XfIKAyExCIuwFAdmuL9wLc'
    });

    // Get the default map types from the Platform object:
    var defaultLayers = platform.createDefaultLayers();

    // Instantiate the map:
    const map = new H.Map(
    document.getElementById('mapContainer'),
    defaultLayers.vector.normal.map,
    {
        zoom: 10,
        center: {lng:-46.949870, lat:-23.089533 }
    });
    
    

    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
    var ui = H.ui.UI.createDefault(map, defaultLayers);

    

    let starterCordenates = {lat:-8.3678162, lng:-35.0315702}
    let starterMarker = new H.map.Marker(starterCordenates)
    starterMarker.setData("<h2>Ipojuca – PE</h2>")
    starterMarker.addEventListener('tap', event =>{
    let bubble = new H.ui.InfoBubble(
        event.target.getGeometry(),{
            content: event.target.getData()
            }
    );
        ui.addBubble(bubble)
    })
    let midleCordenates = {lat:-16.723477129827657, lng:-43.85451872859102}
    let midleMarker = new H.map.Marker(midleCordenates)
    midleMarker.setData("<h2>Monte Carlos</h2>")
    midleMarker.addEventListener('tap', event =>{
    let bubble = new H.ui.InfoBubble(
        event.target.getGeometry(),{
            content: event.target.getData()
            }
    );
        ui.addBubble(bubble)
    })
    let finalCordenates = {lat:-23.1019916, lng:-46.9665265}
    let finalMarker = new H.map.Marker(finalCordenates)
    finalMarker.setData("<h2>Louveira – SP</h2>")
    finalMarker.addEventListener('tap', event =>{
    let bubble = new H.ui.InfoBubble(
        event.target.getGeometry(),{
            content: event.target.getData()
            }
    );
        ui.addBubble(bubble)
    })

    map.addObject(starterMarker)
    map.addObject(midleMarker)
    map.addObject(finalMarker)



    // Now use the map as required...
    calculateRouteFromAtoB(platform,starterCordenates,midleCordenates);
    calculateRouteFromAtoB(platform,midleCordenates,finalCordenates)

    function calculateRouteFromAtoB(platform,originCordenate,destinyCordenate) {
        var router = platform.getRoutingService(null, 8),
            routeRequestParams = {
                routingMode: 'fast',
                transportMode: 'car',
                origin: `${originCordenate.lat},${originCordenate.lng}`, 
                destination: `${destinyCordenate.lat},${destinyCordenate.lng}`,
                return: 'polyline,turnByTurnActions,actions,instructions'
            };

        router.calculateRoute(
            routeRequestParams,
            onSuccess,
            onError
        );
    }

/**
 * This function will be called once the Routing REST API provides a response
 * @param {Object} result A JSONP object representing the calculated route
 *
 * see: http://developer.here.com/rest-apis/documentation/routing/topics/resource-type-calculate-route.html
 */
function onSuccess(result) {
  var route = result.routes[0];

  /*
   * The styling of the route response on the map is entirely under the developer's control.
   * A representative styling can be found the full JS + HTML code of this example
   * in the functions below:
   */
  addRouteShapeToMap(route);
  
}

/**
 * This function will be called if a communication error occurs during the JSON-P request
 * @param {Object} error The error message received.
 */
function onError(error) {
  alert('Can\'t reach the remote server');
}

// add a resize listener to make sure that the map occupies the whole container
window.addEventListener('resize', () => map.getViewPort().resize());

/**
 * Creates a H.map.Polyline from the shape of the route and adds it to the map.
 * @param {Object} route A route as received from the H.service.RoutingService
 */
function addRouteShapeToMap(route) {
  route.sections.forEach((section) => {
    // decode LineString from the flexible polyline
    let linestring = H.geo.LineString.fromFlexiblePolyline(section.polyline);

    // Create a polyline to display the route:
    let polyline = new H.map.Polyline(linestring, {
      style: {
        lineWidth: 4,
        strokeColor: 'rgba(0, 128, 255, 0.7)'
      }
    });

    // Add the polyline to the map
    map.addObject(polyline);
    // And zoom to its bounding rectangle
    map.getViewModel().setLookAtData({
      bounds: polyline.getBoundingBox()
    });
  });

}
  // Hold a reference to any infobubble opened
  var bubble;

/**
 * Opens/Closes a infobubble
 * @param {H.geo.Point} position The location on the map.
 * @param {String} text          The contents of the infobubble.
 */
function openBubble(position, text) {
  if (!bubble) {
    bubble = new H.ui.InfoBubble(
      position,
      // The FO property holds the province name.
      {content: text});
    ui.addBubble(bubble);
  } else {
    bubble.setPosition(position);
    bubble.setContent(text);
    bubble.open();
  }
}




    </script>
   


</html>